# âœ… GitHub Actions ì›Œí¬í”Œë¡œ ì´ë¦„
name: Checkstyle & FindSecBugs

# âœ… ì›Œí¬í”Œë¡œ ì‹¤í–‰ ì¡°ê±´
on:
  pull_request:            # PR ìƒì„± ë˜ëŠ” ì—…ë°ì´íŠ¸ ì‹œ ì‹¤í–‰
    branches: [ develop, main ]  # ëŒ€ìƒ ë¸Œëœì¹˜ëŠ” developê³¼ main

# âœ… ê° Jobë“¤ì´ í•„ìš”í•œ ê¶Œí•œ ì„¤ì •
permissions:
  contents: read
  checks: write
  pull-requests: write
  security-events: write  # FindSecBugs ê²°ê³¼ë¥¼ SARIFë¡œ ì—…ë¡œë“œí•˜ê¸° ìœ„í•œ ê¶Œí•œ

# âœ… ëª¨ë“  Jobì—ì„œ ê³µí†µì ìœ¼ë¡œ ì‚¬ìš©í•  JVM ì˜µì…˜ ì„¤ì •
env:
  _JAVA_OPTIONS: "-Xmx2G -Xms512m"  # JVM ìµœëŒ€/ìµœì†Œ í™ ë©”ëª¨ë¦¬ ì„¤ì •

##############################
# âœ… Checkstyle ê²€ì‚¬ Job ì •ì˜
##############################
jobs:
  checkstyle:
    name: âœ… Run Checkstyle        # GitHub Actions UIì— í‘œì‹œë  ì´ë¦„
    runs-on: ubuntu-latest        # ì‹¤í–‰ í™˜ê²½: ìµœì‹  ìš°ë¶„íˆ¬ ì´ë¯¸ì§€

    steps:
      - name: â¬‡ï¸ Checkout source code
        uses: actions/checkout@v4  # ì €ì¥ì†Œ ì†ŒìŠ¤ì½”ë“œë¥¼ ì²´í¬ì•„ì›ƒ (clone)

      - name: â˜• Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'  # Temurin(OpenJDK ê¸°ë°˜) JDK ì„¤ì¹˜
          java-version: '17'       # Java 17 ì‚¬ìš©

      - name: ğŸ” Run Checkstyle Action
        uses: nikitasavinov/checkstyle-action@0.6.0  # Checkstyle ì „ìš© GitHub Action
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}  # PR ì½”ë©˜íŠ¸ë¥¼ ìœ„í•œ ì¸ì¦ í† í°
          checkstyle_config: checkstyle.xml          # í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ìˆëŠ” Checkstyle ì„¤ì • íŒŒì¼
          reporter: github-pr-review                 # PR ì½”ë©˜íŠ¸ í˜•ì‹ìœ¼ë¡œ ìœ„ë°˜ ì‚¬í•­ì„ ì¶œë ¥
          level: error                                # ì¶œë ¥ ë ˆë²¨ (info, warning, error)
          workdir: .                                 # ì²´í¬ ëŒ€ìƒ ë””ë ‰í† ë¦¬ (ê¸°ë³¸ê°’ì€ ë£¨íŠ¸)

###################################
# âœ… FindSecBugs + SpotBugs ê²€ì‚¬ Job
###################################
  findsecbugs:
    name: ğŸ” Run FindSecBugs
    runs-on: ubuntu-latest        # ì‹¤í–‰ í™˜ê²½: ìµœì‹  ìš°ë¶„íˆ¬ ì´ë¯¸ì§€

    steps:
      - name: â¬‡ï¸ Checkout source code
        uses: actions/checkout@v4  # ì†ŒìŠ¤ì½”ë“œ ì²´í¬ì•„ì›ƒ

      - name: â˜• Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: âš™ï¸ Build project (skip tests)
        run: mvn clean package -DskipTests  # í´ë˜ìŠ¤ íŒŒì¼ ìƒì„±ë§Œ ìˆ˜í–‰ (í…ŒìŠ¤íŠ¸ ìƒëµ)

      - name: ğŸ› SpotBugs + FindSecBugs
        uses: advanced-security/spotbugs-findsecbugs-action@v1.0.6  # SARIF ì¶œë ¥ í¬í•¨ Action
        with:
          spotbugs_version: '4.7.3'               # SpotBugs ë²„ì „
          findsecbugs_version: '1.12.0'           # FindSecBugs í”ŒëŸ¬ê·¸ì¸ ë²„ì „
          spotbugs_target: 'target/classes'       # ë¶„ì„ ëŒ€ìƒ .class íŒŒì¼ ê²½ë¡œ
          spotbugs_filename_glob: '**.class'      # ë¶„ì„ ëŒ€ìƒ í´ë˜ìŠ¤ íŒŒì¼ íŒ¨í„´
          upload_sarif: true                      # GitHub Security íƒ­ì— SARIF ê²°ê³¼ ì—…ë¡œë“œ
